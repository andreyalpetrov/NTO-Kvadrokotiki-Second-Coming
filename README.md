|||
| --- | --- |
| Трек | Летающая робототехника |
| Задание | Командное задание |
| Тип | Инструкция |
| Команда | КвадроКотики |

| Участник           | Роль                |
| ------------------ | ------------------- |
| • Андрей Петров    | инженер техник |
| • Даниил Белов     | инженер программист |
| • Иван Александров | инженер программист |
| • Дмитрий Ковалев  | 3D-моделлер         |

## 1. Установка виртуальной машины.

Для установки виртуальной машины необходимо скачать ПО для виртуализации (Virtual Box, WMVare Player или WMVare Workstation). 
В нашем примере мы будем использовать WMVare Workstation Pro. 
- Устанавливаем ПО для виртуализации;
- Скачиваем образ виртуальной машины с симулятором Клевера с репозитория по ссылке: 
 [Release v1.4 · CopterExpress/clover_vm](https://github.com/CopterExpress/clover_vm/releases/tag/v1.4) ;
 - Открываем ПО для виртуализации, нажимаем `CTRL+O` , или `File->Open` чтобы открыть существующую виртуальную машину. Выбираем скаченный файл `clover-devel_v1.4.ova`;
 - Нам предложат ввести название виртуальной машины. Называем `Clover`;
 - После установки образа и создания ВМ мы можем её настроить. Выбираем нашу ВМ в правой колонке `Library`. Затем нажимаем `Edit virtual machine settings`. В открывшемся окне настраиваем параметры:
	 - Memory. Необходимо выделить минимум половину от имеющейся оперативной памяти, но мы выбираем выделить около 12-13 Гб, т.к. в целом при 16Гб это не сильно повлияет на работоспособность ПК, но ускорит работу симуляции. 
	- Processors. Количество процессоров - 1 (Number of processors).
				Количество ядер - 3. (Number of cores per perocessor).
	- Network Adapter.  Выбрать тип соединения `Bridged: Connected directly to the physical network.` Поставить галочку  на `Connect at power on`. 
	Остальное можно оставить по умолчанию. Жмем кнопку `Ok`. Теперь отображаются актуальные параметры.
## 2. Настройка симулятора. 

После запуска виртуальной машины необходимо подготовить окружение. Для этого необходимо скачать наш репозиторий. Сделать это можно следующим образом:
```bash
cd Desktop
git clone https://github.com/andreyalpetrov/NTO-Kvadrokotiki-Second-Coming.git
```
Перейдя в проводник, перетащите все файлы из скаченной папки на рабочий стол.

Для настройки симулятора был написан скрипт [launch.py](https://github.com/andreyalpetrov/NTO-Kvadrokotiki-Second-Coming/blob/main/launch.py "launch.py"), который выполняет следующие действия: 
	- Скачивает Flask, который в дальнейшем понадобится при разработке веб-интерфейса
	- Генерирует  aruco-карту 5 на 12 метров, изменяет дефолтную aruco-карту на только что сгенерированную в gazebo и применяет её к самому дрону
	- копирует модели нефтепровода и мира gazebo
	- Вносит необходимые изменения в файл `clover.launch` и `aruco.launch`

- Вызываем терминал из рабочего стола, либо переходим с помощью команды и вызываем скрипт.
```bash
cd Desktop #Если вы все ещё не находитесь в данной дериктории - перейдите в неё
python3 launch.py
```
## 3. Случайная генерация мира.

Случайная генерация мира происходит с помощью скрипта [random_gen.py](https://github.com/andreyalpetrov/NTO-Kvadrokotiki-Second-Coming/blob/main/random_gen.py "random_gen.py"), который открывает файл `clover_aruco.world` и добавляет в него 5 случайно размещённых врезок.


С каждым запуском скрипт генерирует расположение врезок случайно. 

Применение скрипта: 

- Закройте Gazebo. 
- Откройте терминал и вызовите следующие команды: 
```bash
cd Desktop #Если вы все ещё не находитесь в данной дериктории - перейдите в неё
python3 random_gen.py
```
- Запустите Gazebo 

## 4. Полетная миссия

Полетная миссия представляет из себя полет дрона из точки `(0, 0)` вдоль нефтепровода. В процессе полёта происходит сканирование на предмет незаконной врезки. Как только программа увидит прямой угол, то !!!!ИСПРАВИТЬ!!!! будет вычислена координата и опубликована в топик  `/tubes`
